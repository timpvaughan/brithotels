{"version":3,"file":"wds-data-reset.js","sources":["includes/assets/js/es6/wds-data-reset.js"],"sourcesContent":[";(function ($) {\n\twindow.Wds = window.Wds || {};\n\n\tclass Data_Reset {\n\t\tconstructor() {\n\t\t\tthis.templates = {\n\t\t\t\tsuccess: window.Wds.tpl_compile(window.Wds.template('reset', 'success')),\n\t\t\t\terror: window.Wds.tpl_compile(window.Wds.template('reset', 'error')),\n\t\t\t\tmultisite_warning: window.Wds.tpl_compile(window.Wds.template('reset', 'multisite-warning')),\n\t\t\t\tmultisite_progress: window.Wds.tpl_compile(window.Wds.template('reset', 'multisite-progress')),\n\t\t\t\tmultisite_success: window.Wds.tpl_compile(window.Wds.template('reset', 'multisite-success')),\n\t\t\t};\n\n\t\t\tthis.init();\n\t\t}\n\n\t\tinit() {\n\t\t\t$(document)\n\t\t\t\t.on('click', '.wds-data-reset-button', (e) => this.handle_reset_button_click(e))\n\t\t\t\t.on('click', '.wds-multisite-data-reset-button', (e) => this.handle_multisite_reset_button_click(e));\n\t\t}\n\n\t\thandle_reset_button_click(e) {\n\t\t\tlet $button = $(e.target).closest('button');\n\t\t\tData_Reset.add_loading_class($button);\n\n\t\t\tthis.reset();\n\t\t}\n\n\t\treset() {\n\t\t\tlet nonce = this.get_nonce();\n\n\t\t\treturn this.post('wds_data_reset', nonce)\n\t\t\t\t.done(() => {\n\t\t\t\t\tthis.show_success_message();\n\t\t\t\t\tData_Reset.reload_page();\n\t\t\t\t})\n\t\t\t\t.fail(() => this.show_error_message());\n\t\t}\n\n\t\tget_modal() {\n\t\t\treturn $('#wds-data-reset-modal');\n\t\t}\n\n\t\tget_modal_body() {\n\t\t\treturn $('.wds-data-reset-modal-body', this.get_modal());\n\t\t}\n\n\t\tget_nonce() {\n\t\t\treturn $('[name=\"_data_reset_nonce\"]', this.get_modal()).val();\n\t\t}\n\n\t\tshow_success_message() {\n\t\t\tlet markup = this.templates.success({});\n\t\t\tthis.get_modal_body().html(markup);\n\t\t}\n\n\t\tshow_error_message() {\n\t\t\tlet markup = this.templates.error({});\n\t\t\tthis.get_modal_body().html(markup);\n\t\t}\n\n\t\thandle_multisite_reset_button_click(e) {\n\t\t\tlet $button = $(e.target).closest('button');\n\t\t\tData_Reset.add_loading_class($button);\n\n\t\t\tthis.reset_multisite();\n\t\t}\n\n\t\treset_multisite() {\n\t\t\tlet nonce = this.get_multisite_nonce();\n\n\t\t\treturn this.post('wds_multisite_data_reset', nonce)\n\t\t\t\t.done(\n\t\t\t\t\t/**\n\t\t\t\t\t * @param {{total_sites:string, completed_sites:string}} data\n\t\t\t\t\t */\n\t\t\t\t\t(data) => {\n\t\t\t\t\t\tlet total_sites = data.total_sites,\n\t\t\t\t\t\t\tcompleted_sites = data.completed_sites,\n\t\t\t\t\t\t\tprogress_message = data.progress_message;\n\n\t\t\t\t\t\tthis.show_multisite_progress_bar(progress_message);\n\t\t\t\t\t\tthis.update_multisite_progress(total_sites, completed_sites);\n\n\t\t\t\t\t\tif (total_sites !== completed_sites) {\n\t\t\t\t\t\t\tthis.reset_multisite();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.show_multisite_success_message();\n\t\t\t\t\t\t\tData_Reset.reload_page();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t.fail(() => this.show_multisite_error_message());\n\t\t}\n\n\t\tshow_multisite_progress_bar(progress_message) {\n\t\t\tlet markup = this.templates.multisite_progress({progress_message: progress_message});\n\t\t\tthis.get_multisite_modal_body().html(markup);\n\t\t}\n\n\t\tshow_multisite_error_message() {\n\t\t\tlet markup = this.templates.error({});\n\t\t\tthis.get_multisite_modal_body().html(markup);\n\t\t}\n\n\t\tshow_multisite_success_message() {\n\t\t\tlet markup = this.templates.multisite_success({});\n\t\t\tthis.get_multisite_modal_body().html(markup);\n\t\t}\n\n\t\tget_multisite_progress_bar() {\n\t\t\treturn this.get_multisite_modal_body().find('.wds-progress');\n\t\t}\n\n\t\tupdate_multisite_progress(total_sites, completed_sites) {\n\t\t\tlet progress_bar = this.get_multisite_progress_bar();\n\t\t\tif (progress_bar.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet site_progress = total_sites > 0\n\t\t\t\t? (completed_sites / total_sites) * 100\n\t\t\t\t: 0;\n\n\t\t\tWds.update_progress_bar(progress_bar, site_progress);\n\t\t}\n\n\t\tpost(action, nonce) {\n\t\t\tlet deferred = new $.Deferred();\n\n\t\t\t$.post(ajaxurl, {\n\t\t\t\taction: action,\n\t\t\t\t_wpnonce: nonce\n\t\t\t}).done((data) => {\n\t\t\t\tdata = (data || {});\n\t\t\t\tif (data.success) {\n\t\t\t\t\tdeferred.resolve(data.data);\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.reject();\n\t\t\t\t}\n\t\t\t}).fail(deferred.reject);\n\n\t\t\treturn deferred;\n\t\t}\n\n\t\tget_multisite_nonce() {\n\t\t\treturn $('[name=\"_multi_data_reset_nonce\"]', this.get_multisite_modal()).val();\n\t\t}\n\n\t\tget_multisite_modal_body() {\n\t\t\treturn $('.wds-multisite-data-reset-modal-body', this.get_multisite_modal());\n\t\t}\n\n\t\tget_multisite_modal() {\n\t\t\treturn $('#wds-multisite-data-reset-modal');\n\t\t}\n\n\t\tstatic add_loading_class($button) {\n\t\t\treturn $button.addClass('sui-button-onload');\n\t\t}\n\n\t\tstatic reload_page() {\n\t\t\tsetTimeout(() => window.location.reload(), 1500);\n\t\t}\n\t}\n\n\t$(function () {\n\t\tnew Data_Reset();\n\t});\n})(jQuery);\n"],"names":["$","window","Wds","Data_Reset","templates","success","tpl_compile","template","error","multisite_warning","multisite_progress","multisite_success","init","document","on","e","handle_reset_button_click","handle_multisite_reset_button_click","$button","target","closest","add_loading_class","reset","nonce","get_nonce","post","done","show_success_message","reload_page","fail","show_error_message","get_modal","val","markup","get_modal_body","html","reset_multisite","get_multisite_nonce","data","total_sites","completed_sites","progress_message","show_multisite_progress_bar","update_multisite_progress","show_multisite_success_message","show_multisite_error_message","get_multisite_modal_body","find","progress_bar","get_multisite_progress_bar","length","site_progress","update_progress_bar","action","deferred","Deferred","ajaxurl","_wpnonce","resolve","reject","get_multisite_modal","addClass","setTimeout","location","reload","jQuery"],"mappings":"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"}